#!/bin/bash

set -e

. $HOME/.zshrc_utils

if [[ $(git --no-pager show --pretty=format:"%s" -s) =~ ^--wip-- ]]; then
  echo -e "$(yellow "[WARN] WIP commit detected.")"
  echo -en "\nCommit: "
  git --no-pager log HEAD --stat -n 1 --pretty=format:"%B"
  echo
  while true; do
    read -p "$(echo -e "$(green "[NOTE] UNWIP? (Y/n)") ")" -n1 answer </dev/tty
    case $answer in
    Y | y | '')
      git reset HEAD~1 --quiet
      echo -e "\n$(green "[NOTE] Done.")"
      break
      ;;
    n )
      echo -e "\n$(red "[WARN] Canceled.")"
      break
      ;;
    *)
      echo -ne "$(yellow " - Y or n (default \"y\")")\n"
      ;;
    esac
  done
fi